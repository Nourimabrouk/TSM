ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()
# 14.5 (i) # Demeaned returns
plot_demeaned <- ggplot(plot_returns_input, aes(index, demeaned))+
theme_minimal()+
geom_line()+
geom_hline(yintercept = 0)+
scale_y_continuous(breaks = seq(-.05,.05,.025))+
scale_x_continuous(breaks = seq(0,900,100))
# Transformed
plot_transformed <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-20,5))
plot_returns_input <- returns %>% mutate(
alpha = outputSmooth_returns$alpha,
H_filtered = h_t - xi,
H_smoothed = outputSmooth_returns$alpha - xi)
saveRDS(plot_returns_input, file = "plot_returns_input.rds")
plot_returns_input = readRDS(file = "plot_returns_input.rds")
plot_returns_input
#plot 1
ggplot(data = plot_returns_input, aes(x = index))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
geom_line(aes(y = alpha))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
geom_line(aes(y = alpha))+
scale_x_continuous(breaks = seq(0,900,100))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
geom_line(aes(y = alpha))+
scale_x_continuous(breaks = seq(0,900,100)) +
theme_minimal()+
ggtitle("Alpha")
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha))+
scale_x_continuous(breaks = seq(0,900,100)) +
ggtitle("Alpha")
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha))+
scale_x_continuous(breaks = seq(0,900,100)) +
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-20,5))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,5)
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha))+
geom_points(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha))+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha, color = "red"))+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha, color = "red", size = 2))+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha, color = "red", size = 1.5))+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha, color = "red", size = 1))+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha, color = "red", size = .11))+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha, color = "red"))+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red" )+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index, color = y)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2)+
geom_point(aes(y = transformed))
, color = "red"
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
#plot 1
ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,-5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
#plot 1
plot_alpha <- ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,-5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
plot_filtered <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(y = H_filtered)+
ggtitle("filtered")+xlab("Index")+ylab("filtered")
plot_filtered <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y = H_filtered))+
ggtitle("filtered")+xlab("Index")+ylab("filtered")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
ggtitle("smoothed")+xlab("Index")+ylab("smoothed")
plot_smoothed
plot_filtered
plot_smoothed
plot_filtered
plot_returns_input
# Data prep
rm(list=ls())
library(ggplot2)
library(ggthemes)
plot_returns_input = readRDS(file = "plot_returns_input.rds")
plot_returns_input
#Quickplots
autoplot(plot_returns_input, demeaned)
autoplot(plot_returns_input, transformed)
autoplot(stonkdata, Close)
autoplot(stonkdata, RV)
range(plot_returns_input$demeaned)
# 14.5 (i) # Demeaned returns
plot_demeaned <- ggplot(plot_returns_input, aes(index, demeaned))+
theme_minimal()+
geom_line()+
geom_hline(yintercept = 0)+
scale_y_continuous(breaks = seq(-.05,.05,.025))+
scale_x_continuous(breaks = seq(0,900,100))+
ggtitle("Demeaned")+xlab("Index")+ylab("Demeaned")
# Transformed
plot_transformed <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()+
ggtitle("Transformed")+xlab("Index")+ylab("Transformed")
plot_alpha <- ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,-5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
plot_filtered <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y = H_filtered))+
ggtitle("Filtered")+xlab("Index")+ylab("Filtered")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_transformed <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()+
ggtitle("Transformed")+xlab("Index")+ylab("Transformed")
#f
# Data prep
rm(list=ls())
library(ggplot2)
library(ggthemes)
plot_returns_input = readRDS(file = "plot_returns_input.rds")
plot_returns_input
# #Quickplots
# autoplot(plot_returns_input, demeaned)
# autoplot(plot_returns_input, transformed)
# autoplot(stonkdata, Close)
# autoplot(stonkdata, RV)
# range(plot_returns_input$demeaned)
# 14.5 (i) # Demeaned returns
plot_demeaned <- ggplot(plot_returns_input, aes(index, demeaned))+
theme_minimal()+
geom_line()+
geom_hline(yintercept = 0)+
scale_y_continuous(breaks = seq(-.05,.05,.025))+
scale_x_continuous(breaks = seq(0,900,100))+
ggtitle("Demeaned")+xlab("Index")+ylab("Demeaned")
# Transformed
plot_transformed <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()+
ggtitle("Transformed")+xlab("Index")+ylab("Transformed")
plot_alpha <- ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,-5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
plot_filtered <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y = H_filtered))+
ggtitle("Filtered")+xlab("Index")+ylab("Filtered")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_transformed <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()+
ggtitle("Transformed")+xlab("Index")+ylab("Transformed")
#f
# Data prep
rm(list=ls())
library(ggplot2)
library(ggthemes)
plot_returns_input = readRDS(file = "plot_returns_input.rds")
plot_returns_input
# #Quickplots
# autoplot(plot_returns_input, demeaned)
# autoplot(plot_returns_input, transformed)
# autoplot(stonkdata, Close)
# autoplot(stonkdata, RV)
# range(plot_returns_input$demeaned)
# 14.5 (i) # Demeaned returns
plot_demeaned <- ggplot(plot_returns_input, aes(index, demeaned))+
theme_minimal()+
geom_line()+
geom_hline(yintercept = 0)+
scale_y_continuous(breaks = seq(-.05,.05,.025))+
scale_x_continuous(breaks = seq(0,900,100))+
ggtitle("Demeaned")+xlab("Index")+ylab("Demeaned")
# Transformed
plot_transformed <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()+
ggtitle("Transformed")+xlab("Index")+ylab("Transformed")
plot_alpha <- ggplot(data = plot_returns_input, aes(x = index)) +
theme_minimal()+
geom_line(aes(y = alpha), size = 2, color = "red")+
geom_point(aes(y = transformed))+
scale_x_continuous(breaks = seq(0,900,100)) +
ylim(-20,-5)+
ggtitle("Alpha")+xlab("Index")+ylab("Alpha")
plot_filtered <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y = H_filtered))+
ggtitle("Filtered")+xlab("Index")+ylab("Filtered")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_transformed <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line()+
ggtitle("Transformed")+xlab("Index")+ylab("Transformed")
plot_demeaned
plot_transformed
plot_alpha
plot_filtered
plot_smoothed
plot_transformed
plot_filtered <- ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y = H_filtered))+
ggtitle("Filtered")+xlab("Index")+ylab("Filtered")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
geom_line(aes(y=H_filtered), col = "red")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
geom_line(aes(y=H_filtered), col = "red") +
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
geom_line(aes(y=H_filtered), col = "red") +
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_d_combined <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
geom_line(aes(y=H_filtered), col = "red") +
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_d_combined
plot_returns_input
plot_smoothed <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot_filtered
plot_smoothed
plot_d_combined <-ggplot(plot_returns_input, aes(index, transformed))+
theme_minimal()+
geom_line(aes(y=H_smoothed))+
geom_line(aes(y=H_filtered), col = "red") +
ggtitle("Smoothed")+xlab("Index")+ylab("Smoothed")
plot(ts(H_filtered_stock), col="red", plot.type="single", ylab="", main="H_t Filtered")
rm(list=ls())
# Imports ----------
source("functions.R")
#source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(ggthemes)
library(fable)
library(tseries)
library(moments)
setwd(here())
options(warn=-1)
# Data import & cleaning --------
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)) %>%
as_tsibble()
# ab
transformed_df = transform_data(stockdata, returns)
input_stocks = transformed_df[[1]]
input_returns = transformed_df[[2]]
# Descriptive stats
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_b
descriptive_e1 <- descriptive_stats(input_stocks[,1])
descriptive_e1
descriptive_e2 <- descriptive_stats(input_stocks[,-1])
descriptive_e2
#c / e -> need to separate these?
par_ini <- c(0.1082, 0.98, -0.2, 0.9)
initial_parameters <- initialise_parameters_QML(par_ini)
state_space_parameters <- initial_parameters[[1]]
par_ini <- initial_parameters[[2]]
QML_params_returns <- optimize_parameters(input_returns, par_ini[-4], state_space_parameters, TRUE) # (Print_output = TRUE)
QML_params_stocks <- optimize_parameters(input_stocks[,1], par_ini[-4], state_space_parameters, TRUE)
QML_params_stocks_rv <- optimize_parameters(input_stocks, par_ini, state_space_parameters, TRUE)
#d
outputKalman_returns <- compute_kalmanfilter(input_returns, QML_params_returns, state_space_parameters)
outputSmooth_returns <- compute_smoothed_state(input_returns, QML_params_returns, outputKalman_returns)
outputKalman_stocks <- compute_kalmanfilter(input_stocks[,1], QML_params_stocks, state_space_parameters)
outputSmooth_stocks <- compute_smoothed_state(input_stocks[,1], QML_params_stocks, outputKalman_stocks)
outputKalman_stocks_rv <- compute_kalmanfilter(input_stocks, QML_params_stocks_rv, state_space_parameters)
outputSmooth_stocks_rv <- compute_smoothed_state(input_stocks, QML_params_stocks_rv, outputKalman_stocks_rv)
plot(ts(outputKalman_stocks_rv$P))
plot(ts(outputKalman_stocks$P))
source("functions.R")
#plot 1
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(min(returns$transformed), max(returns$transformed)))
points(returns$transformed, col="black")
xi_sv <- QML_params_returns[3]/(1 - QML_params_returns[2])
xi_stocks <- QML_params_stocks[3]/(1 - QML_params_stocks[2])
xi_stocks_rv <- QML_params_stocks_rv[3]/(1 - QML_params_stocks_rv[2])
#plot 2
h_t <- outputKalman_returns$h_t
H_filtered <- h_t - xi_sv
plot(ts(H_filtered), col="red", plot.type="single", ylab="", main="H_t Filtered")
#plot 3
H_smoothed <- outputSmooth_returns$alpha - xi_sv
plot(ts(H_smoothed), col="red", plot.type="single", ylab="", main="H_t Smoothed")
#plot 2e
h_t_stock <- outputKalman_stocks$h_t
h_t_stock_rv <- outputKalman_stocks_rv$h_t
H_filtered_stock <- h_t_stock - xi_stocks
H_filtered_stock_rv <- h_t_stock_rv - xi_stocks_rv
plot(ts(H_filtered_stock), col="red", plot.type="single", ylab="", main="H_t Filtered")
lines(ts(H_filtered_stock_rv))
#plot 3e
H_smoothed <- outputSmooth_stocks$alpha - xi_stocks
H_smoothed_rv <- outputSmooth_stocks_rv$alpha - xi_stocks_rv
plot(ts(H_smoothed), col="red", plot.type="single", ylab="", main="H_t Smoothed")
plot(ts(H_smoothed_rv), col="red", plot.type="single", ylab="", main="H_t Smoothed")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(min(returns$transformed), max(returns$transformed)))
points(returns$transformed, col="black")
#f
# From tutorial 5:
n = 100;
omega = -0.088; phi = 0.991; sigma_eta = 0.084
#perform_particlefilter_routine(n, sigma_eta, phi, sigma, theta_t, y_t)
#plots are for:
# a) Original
returns
stockdata
#   transformed
# b) x_t (transformed)
# d) h_filtered
#    h_smoothed
plot_returns_input <- returns %>% mutate(
alpha = outputSmooth_returns$alpha,
H_filtered = h_t - xi_sv,
H_smoothed = outputSmooth_returns$alpha - xi_sv)
saveRDS(plot_returns_input, file = "plot_returns_input.rds")
# e) stockdata
# f) ?
h_t_stock <- outputKalman_stocks$h_t
h_t_stock_rv <- outputKalman_stocks_rv$h_t
H_filtered_stock <- h_t_stock - xi_stocks
H_filtered_stock_rv <- h_t_stock_rv - xi_stocks_rv
plot(ts(H_filtered_stock), col="red", plot.type="single", ylab="", main="H_t Filtered")
lines(ts(H_filtered_stock_rv))
plot_returns_input <- returns %>% mutate(
alpha = outputSmooth_returns$alpha,
H_filtered = h_t - xi_sv,
H_smoothed = outputSmooth_returns$alpha - xi_sv,
h_t_stock = h_t_stock,
h_t_stock_rv = h_t_stock_rv,
H_filtered_stock = H_filtered_stock,
H_filtered_stock_rv = H_filtered_stock_rv)
plot_returns_input <- returns %>% mutate(
alpha = outputSmooth_returns$alpha,
H_filtered = h_t - xi_sv,
H_smoothed = outputSmooth_returns$alpha - xi_sv,
h_t_stock = h_t_stock,
h_t_stock_rv = h_t_stock_rv,
H_filtered_stock = H_filtered_stock,
H_filtered_stock_rv = H_filtered_stock_rv)
plot_returns_input <- returns %>% mutate(
alpha = outputSmooth_returns$alpha,
H_filtered = h_t - xi_sv,
H_smoothed = outputSmooth_returns$alpha - xi_sv)
plot_returns_input <- returns %>% mutate(
alpha = outputSmooth_returns$alpha,
H_filtered = h_t - xi_sv,
H_smoothed = outputSmooth_returns$alpha - xi_sv,
h_t_stock = h_t_stock,
h_t_stock_rv = h_t_stock_rv)
h_t_stock
plot_stock_input <- stockdata %>%
mutate(
h_t_stock = h_t_stock,
h_t_stock_rv = h_t_stock_rv,
H_filtered_stock = H_filtered_stock,
H_filtered_stock_rv = H_filtered_stock_rv
)
plot_stock_input <- stockdata %>%
slice(-1) %>%
mutate(
h_t_stock = h_t_stock,
h_t_stock_rv = h_t_stock_rv,
H_filtered_stock = H_filtered_stock,
H_filtered_stock_rv = H_filtered_stock_rv
)
saveRDS(plot_stock_input, file = "plot_stock_input.rds")
plot_returns_input = readRDS(file = "plot_stock_input.rds")
plot_stock_input = readRDS(file = "plot_stock_input.rds")
plot_returns_input = readRDS(file = "plot_returns_input.rds")
plot_stock_input = readRDS(file = "plot_stock_input.rds")
