par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(disturbance$eps[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(-300,300))
abline(h=0,col="red")
plot(ts(disturbance$sd_eps[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(45,65))
plot(ts(disturbance$eta[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-40,40))
abline(h=0,col="red")
plot(ts(disturbance$sd_eta[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(35,40))
,mar=c(4.1,4.1,1.1,2.1))
plot(ts(a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(kalman$a_lb[2:99],start=c(1871, 1)), col="red")
lines(ts(kalman$a_ub[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(P[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(5000,17000))
plot(ts(v[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-500,500))
abline(h=0,col="red")
plot(ts(F[2:99],
# Plot KF
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(a_lb[2:99],start=c(1871, 1)), col="red")
rm(list=ls())
# Imports ----------
library(tidyverse)
library(here)
library(ggplot2)
library(ggthemes)
options(warn=-1)
setwd(here())
data = Nile
###### Functions --------
# Smoothed state
SmoothedState <- function(a, P, v, F, K){
n <- length(v)
alpha <- rep(0,n)
N <- rep(0,n)
r <- rep(0,n)
V <- rep(0,n) #smoothed state variance
L <- 1 - K
N[n-1] <- 0
r[n-1] <- 0
for (j in n:2){ #reversed loop
if (j>1){
N[j-1] <- (1/F[j])+L[j]^2 * N[j]
}
if (is.nan(v[j])){
r[j-1] <- r[j]
} else {
r[j-1] <- (v[j]/F[j])+L[j]*r[j]
V[j] <- P[j] - P[j]^2 * N[j-1]
alpha[j] <- a[j]+P[j]*r[j-1]
}
#upper and lower bounds of alpha
alpha_lb <- alpha - 1.645*sqrt(V)
alpha_ub <- alpha + 1.645*sqrt(V)
SmoothedState_df <- data.frame(alpha, N, r, V, alpha_lb, alpha_ub)
return (SmoothedState_df)
}
DisturbancesSmoothing <- function(F,v,K,r,N){
u <- 1/F*V-K*r
eps <- sig_eps*u
D <- 1/F + K^2*N
var_eps <- sig_eps - sig_eps^2*D
eta <- sig_eta*r
var_eta <- sig_eta - sig_eta^2*N
sd_eps <- sqrt(var_eps)
sd_eta <- sqrt(var_eta)
disturbance <- data.frame(eps,eta,sd_eps,sd_eta)
return(disturbance)
}
KalmanFilter <- function(data,sig_eps,sig_eta){
y <- as.matrix(data)
n <- nrow(y)
a <- rep(0,n)
P <- rep(0,n)
v <- rep(0,n)
F <- rep(0,n)
K <- rep(0,n)
a_y <- rep(0,n)
P_y <- rep(0,n)
a[1] <- a_ini
P[1] <- P_ini
for (i in 1:n) {
v[i] <- y[i]-a[i]
F[i] <- P[i]+ sig_eps
if(is.nan(y[i])){
K[i] <- 0
a_y[i] <- a[i]
P_y[i] <- P[i]
a[i+1] <- P[i]+sig_eta
}else{
K[i] <- P[i]/F[i]
a_y[i] <- a[i] + K[i]*v[i]
P_y[i]  = P[i]*(1-K[i])
if(i < (n-1)){
a[i+1] <- a[i] + K[i]*v[i]
P[i+1] <- P[i]*(1-K[i])+sig_eta
}
# Upper and lower bounds of a
a_lb <- a-1.645*sqrt(P)
a_ub <- a+1.645*sqrt(P)
kalman <- data.frame(a,P,v,F,K,a_y,P_y,a_lb,a_ub)
return(kalman)
}
# Given Parameter
sig_eps <- 15099
sig_eta <- 1469.1
# Initial values
a_ini <- 0
P_ini <- 10^7
theta <- c(a_ini, P_ini)
kalman <- KalmanFilter(data,sig_eps,sig_eta)
# Smoothed State
a <- kalman$a
P <- kalman$P
v <- kalman$v
F <- kalman$F
K <- kalman$K
SmoothedState_df <- SmoothedState(a,P,v,F,K)
# Disturbances Smoothing
F <- kalman$F
V <- kalman$v
k <- kalman$K
r <- SmoothedState_df$r
N <- SmoothedState_df$N
disturbance <- DisturbancesSmoothing(F,V,K,r,N)
# Results
disturbance
SmoothedState_df
kalman
# Plot KF
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
a[2:99]
# Plot KF
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(kalman$a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(kalman$a_lb[2:99],start=c(1871, 1)), col="red")
lines(ts(kalman$a_ub[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(kalman$v[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-500,500))
# Plot KF
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(kalman$a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(kalman$a_lb[2:99],start=c(1871, 1)), col="red")
lines(ts(kalman$a_ub[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(kalman$P[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(5000,17000))
plot(ts(kalman$v[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-500,500))
abline(h=0,col="red")
plot(ts(kalman$F[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(20000,32000))
# Plot SS
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(alpha[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(400,1300))
alpha[2:99]
alpha
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(SmoothedState_df$alpha[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(400,1300))
lines(ts(SmoothedState_df$alpha_lb[2:99],start=c(1871, 1)), col="red")
lines(ts(SmoothedState_df$alpha_ub[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(SmoothedState_df$V[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(2000,4000))
plot(ts(SmoothedState_df$r[1:100],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-0.04,0.04))
abline(h=0,col="red")
plot(ts(SmoothedState_df$N[1:100],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(6*10^(-5),0.00011))
# Plot DS
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(disturbance$eps[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(-300,300))
abline(h=0,col="red")
plot(ts(disturbance$sd_eps[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(45,65))
plot(ts(disturbance$eta[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-40,40))
abline(h=0,col="red")
plot(ts(disturbance$sd_eta[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(35,40))
# Plot KF
mtext(“Title for Two Plots”, outer = TRUE, cex = 1.5)
# Plot KF
mtext("Title for Two Plots", outer = TRUE, cex = 1.5)
# Plot KF
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(kalman$a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(kalman$a_lb[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(kalman$v[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-500,500))
plot(ts(kalman$F[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(20000,32000))
plot(ts(kalman$P[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(5000,17000))
abline(h=0,col="red")
lines(ts(kalman$a_ub[2:99],start=c(1871, 1)), col="red")
mtext("Title for Two Plots", outer = TRUE, cex = 1.5)
mtext("Title for Two Plots", outer = FALSE, cex = 1.5)
plot(ts(kalman$F[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(20000,32000))
mtext("Title for Two Plots", outer = FALSE, cex = 1.5)
# Plot KF
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(kalman$a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(kalman$a_lb[2:99],start=c(1871, 1)), col="red")
lines(ts(kalman$a_ub[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(kalman$P[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(5000,17000))
plot(ts(kalman$v[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-500,500))
abline(h=0,col="red")
plot(ts(kalman$F[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(20000,32000))
mtext("Title for Two Plots", outer = FALSE, cex = 1.5)
mtext("Title for Two Plots", outer = TRUE, cex = 1.5)
mtext("Title for Two Plots", outer = FALSE, cex = .5)
# Plot KF
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(kalman$a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(kalman$a_lb[2:99],start=c(1871, 1)), col="red")
lines(ts(kalman$a_ub[2:99],start=c(1871, 1)), col="red")
plot(ts(kalman$P[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(5000,17000))
plot(ts(kalman$v[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-500,500))
points(ts(data,start=c(1871, 1)), col="red")
abline(h=0,col="red")
plot(ts(kalman$F[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(20000,32000))
# Plot KF (2.1)
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(kalman$a[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(0,1400))
lines(ts(kalman$a_lb[2:99],start=c(1871, 1)), col="red")
lines(ts(kalman$a_ub[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(kalman$P[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(5000,17000))
plot(ts(kalman$v[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-500,500))
abline(h=0,col="red")
plot(ts(kalman$F[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(20000,32000))
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(SmoothedState_df$alpha[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(400,1300))
lines(ts(SmoothedState_df$alpha_ub[2:99],start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
lines(ts(SmoothedState_df$alpha_lb[2:99],start=c(1871, 1)), col="red")
plot(ts(SmoothedState_df$V[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(2000,4000))
plot(ts(SmoothedState_df$r[1:100],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-0.04,0.04))
abline(h=0,col="red")
plot(ts(SmoothedState_df$N[1:100],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(6*10^(-5),0.00011))
# Plot DS
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(disturbance$eps[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(-300,300))
abline(h=0,col="red")
plot(ts(disturbance$sd_eps[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(45,65))
plot(ts(disturbance$eta[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-40,40))
abline(h=0,col="red")
plot(ts(disturbance$sd_eta[2:99],start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(35,40))
rm(list=ls())
n = 100
for (j in (n-1):1){ #reversed loop
print(j)
}
"
TSM Assignment 1
Figures:
2.1 Done
2.2 Done
2.3 First observation missing? Something not completely right atleast
2.5 Panel (iv) missing
2.6 - 2.9 Convert to packageless implementation
"
# Imports ----------
library(tidyverse)
library(here)
library(ggplot2)
library(ggthemes)
options(warn=-1)
# Data import--------
setwd(here())
data = Nile
# Functions --------
# Smoothed state
kalman_filter <- function(data, theta, sig_eps, sig_eta){
y <- as.matrix(data)
n <- nrow(y)
a <- rep(0,n)   # filter estimator
P <- rep(0,n)   # variance of filtered estimator
v <- rep(0,n)   # prediction error
F <- rep(0,n)   # variance of prediction error
K <- rep(0,n)   # kalman gain
a_y <- rep(0,n) # one-step ahead estimator
P_y <- rep(0,n) # variance of one-step ahead estimator
a[1] <- theta[1]
P[1] <- theta[2]
for (i in 1:n) {
v[i] <- y[i] - a[i]
F[i] <- P[i] + sig_eps
if(is.nan(y[i]) || is.na(y[i])){
K[i] <- 0
a_y[i] <- a[i]
P_y[i] <- P[i]
a[i+1] <- a[i]
P[i+1] <- P[i] + sig_eta
print(a[i])
} else{
K[i] <- P[i]/F[i]
a_y[i] <- a[i] + K[i]*v[i]
P_y[i]  = P[i]*(1-K[i])
if(i < (n-1)){
a[i+1] <- a[i] + K[i]*v[i]
P[i+1] <- P[i] * (1-K[i]) + sig_eta
}
# Upper and lower bounds of a
a_lb <- a-1.645*sqrt(P)
a_ub <- a+1.645*sqrt(P)
kalman <- data.frame(a, P, v, F, K, a_y, P_y, a_lb, a_ub)
return(kalman)
}
smoothed_state <- function(a, P, v, F, K){
n <- length(v)
alpha <- rep(0,n) # smoothed stated
N <- rep(0,n)     # smoothed state error variance
r <- rep(0,n)
V <- rep(0,n)     # smoothed state variance
L <- 1 - K
N[n] <- 0
r[n] <- 0
for (j in n:2){ #reversed loop
if (j > 1){
N[j-1] <- (1/F[j]) + L[j]^2 * N[j]
}
if (is.nan(v[j]) || is.na(v[j])){
r[j-1] <- r[j]
V[j] <- P[j] - P[j]^2 * N[j-1]
alpha[j] <- a[j]+P[j]*r[j-1]
}
else {
r[j-1] <- (v[j]/F[j])+L[j]*r[j]
V[j] <- P[j] - P[j]^2 * N[j-1]
alpha[j] <- a[j]+P[j]*r[j-1]
}
#upper and lower bounds of alpha
alpha_lb <- alpha - 1.645*sqrt(V)
alpha_ub <- alpha + 1.645*sqrt(V)
SmoothedState_df <- data.frame(alpha, N, r, V, alpha_lb, alpha_ub)
return (SmoothedState_df)
}
disturbances_smoothing <- function(F, v, K, r, N){
u <- 1/F*V-K*r
eps <- sig_eps*u
D <- 1/F + K^2*N
var_eps <- sig_eps - sig_eps^2*D
eta <- sig_eta*r
var_eta <- sig_eta - sig_eta^2*N
sd_eps <- sqrt(var_eps)
sd_eta <- sqrt(var_eta)
disturbance <- data.frame(eps,eta,sd_eps,sd_eta)
return(disturbance)
}
# -------- Main --------
# Kalman Filter
sig_eps <- 15099
sig_eta <- 1469.1
a_ini <- 0
P_ini <- 10^7
theta <- c(a_ini, P_ini)
df_kalman_filtered_state <- kalman_filter(data, theta, sig_eps, sig_eta)
# Smoothed State
a <- df_kalman_filtered_state$a
P <- df_kalman_filtered_state$P
v <- df_kalman_filtered_state$v
F <- df_kalman_filtered_state$F
K <- df_kalman_filtered_state$K
df_smoothed_state <- smoothed_state(a, P, v, F, K)
# Disturbances Smoothing
F <- df_kalman_filtered_state$F
V <- df_kalman_filtered_state$v
k <- df_kalman_filtered_state$K
r <- df_smoothed_state$r
N <- df_smoothed_state$N
df_disturbance <- disturbances_smoothing(F, V, K, r, N)
# Results
summary(df_disturbance)
summary(df_smoothed_state)
summary(df_kalman_filtered_state)
# Missing data
missing_values_index <- c(21:40, 61:80)
data_missing <- data
data_missing[missing_values_index] <- NA
data_missing
df_kalman_missing_data <- kalman_filter(data_missing, theta, sig_eps, sig_eta)
a_missing <- df_kalman_missing_data$a
P_missing <- df_kalman_missing_data$P
F_missing <- df_kalman_missing_data$F
v_missing <- df_kalman_missing_data$v
k_missing <- df_kalman_missing_data$K
r_missing <- df_kalman_missing_data$r
N_missing <- df_kalman_missing_data$N
df_smoothed_state_missing_data <- smoothed_state(a_missing, P_missing, v_missing, F_missing, k_missing)
F_missing <- df_kalman_missing_data$F
V_missing <- df_kalman_missing_data$v
k_missing <- df_kalman_missing_data$K
r_missing <- df_smoothed_state_missing_data$r
N_missing <- df_smoothed_state_missing_data$N
df_disturbance_missing_data <- disturbances_smoothing(F_missing, V_missing, k_missing, r_missing, N_missing)
# Slightly plagiarised - need to alter --------
data(Nile)
Nile2 <- c(Nile,rep(NA,30))
model <- SSModel( Nile2 ~ SSMtrend(1, Q = c(model$Q)) , H = c(model$H))
out <- KFS(model, filtering='state',
smoothing=c('state','signal','disturbance'),simplify=F)
par(mfrow=c(2,2))
conf.bands <- cbind(out$a, as.vector(out$a) +
(sqrt(cbind(out$P))* qnorm(0.95))%*% (t(c(-1,1))))
temp <- cbind(Nile2, conf.bands[-1,])
cols <- c("grey","blue","red","red")
lwd <- c(1,2,1,1)
lty <- c(1,1,2,2)
plot.ts(temp, plot.type="single", col = cols,lwd = lwd,lty=lty,xlab="",ylab="",main="i")
legend("topright",
legend = c("Observation Data","Forecasts","Confidence intervals"),
col = c("grey","blue","red"), lty = c(1,1,2),
lwd = c(1,2,1),bty="n", cex=0.8 )
temp <- ts( c(out$P)[-1],start = 1871)
plot(temp, col = "blue",lwd = 2,xlab="",ylab="",main ="ii")
temp <- ts( c(out$alphahat)[-1],start = 1871)
plot(temp, col = "blue",lwd = 2,xlab="",ylab="",
ylim=c(700,1250),main = "iii")
temp <- ts( c(out$F)[-1],start = 1871)
plot(temp, col = "blue",lwd = 2,
xlab="",ylab="",main = "iv")
model <- SSModel( Nile ~ SSMtrend(1, Q = list(matrix(NA))) , H = matrix(NA))
model <- fitSSM( inits = c(log(var(Nile)) , log(var(Nile) ) ) ,
model = model, method ='BFGS' )$model
out <- KFS(model, filtering='state', smoothing=c('state','signal','disturbance'),
simplify=F)
stdres <- rstandard(out)
par(mfrow=c(2,2))
temp <- ts(stdres,start = 1871)
plot(temp, col = "blue",lwd = 2,xlab="",ylab="", main ="i")
abline(h=0, col = "grey")
hist(stdres, prob=T, col = "grey", main = "ii", xlab ="",ylab="")
lines(density(stdres[-1]), col = "blue",lwd = 2)
qqnorm(c(stdres), col="blue",main = "iii")
qqline(c(stdres),col="red")
acf(stdres[-1], ,main="iv")
out <- KFS(model, filtering='state', smoothing=c('state','signal','disturbance'),
simplify=F)
temp1 <- out$epshat/sqrt(c(out$V_eps))
temp2 <- out$etahat/sqrt(c(out$V_eta))
par(mfrow=c(2,2))
temp <- ts(temp1,start = 1871)
plot(temp, col = "blue",lwd = 2,xlab="",ylab="",
main="i")
abline(h=0, col = "grey")
hist(temp, prob=T, col = "grey", ,ylim=c(0,0.3),
main="ii",xlab="",ylab="")
lines(density(temp), col = "blue",lwd = 2)
temp <- ts(temp2,start = 1871)
plot(temp, col = "blue",lwd = 2,xlab="",ylab="" ,main ="iii")
abline(h=0, col = "grey")
hist(temp, prob=T, col = "grey", main = "iv",
ylim=c(0,1.2),xlab="",ylab="")
lines(density(temp), col = "blue",lwd = 2)
# --------Plotting-------
# Plot KF (2.1)
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
filtered_state <- df_kalman_filtered_state$a[2:99]
filtered_state_lower_bound <- df_kalman_filtered_state$a_lb[2:99]
filtered_state_upper_bound <- df_kalman_filtered_state$a_ub[2:99]
filtered_variance <- df_kalman_filtered_state$P[2:99]
state_error <- df_kalman_filtered_state$v[2:99]
state_error_variance <- df_kalman_filtered_state$F[2:99]
y_lim_one <- c(min(data), max(data))
y_lim_two <- c(min(filtered_variance), max(filtered_variance))
y_lim_three <- c(min(state_error), max(state_error))
y_lim_four <- c(min(state_error_variance), max(state_error_variance))
plot(ts(filtered_state,start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=y_lim_one)
lines(ts(filtered_state_lower_bound, start=c(1871, 1)), col="red")
lines(ts(filtered_state_upper_bound, start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)))
plot(ts(filtered_variance, start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=y_lim_two)
plot(ts(state_error, start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=y_lim_three)
abline(h=0,col="red")
plot(ts(state_error_variance, start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=y_lim_four)
# Plot SS (2.2)
# ii) en iv) lijken in de vroegste observaties niet overeen te komen met het boek (pg 22 / 45)
smooth_state <- df_smoothed_state$alpha[2:99]
smooth_state_lower_bound <- df_smoothed_state$alpha_lb[2:99]
smooth_state_upper_bound <- df_smoothed_state$alpha_ub[2:99]
smooth_variance <- df_smoothed_state$V[2:99]
state_error <- df_smoothed_state$r[1:100]
state_error_variance <- df_smoothed_state$N[1:100]
y_lim_one <- c(min(data), max(data))
y_lim_two <- c(min(smooth_variance), max(smooth_variance))
y_lim_three <- c(min(state_error), max(state_error))
y_lim_four <- c(min(state_error_variance), max(state_error_variance))
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(smooth_state, start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=y_lim_one)
lines(ts(smooth_state_lower_bound, start=c(1871, 1)), col="red")
lines(ts(smooth_state_upper_bound, start=c(1871, 1)), col="red")
points(ts(data,start=c(1871, 1)), col="red")
plot(ts(df_smoothed_state$V[2:99], start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=y_lim_two)
plot(ts(df_smoothed_state$r[1:100], start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=y_lim_three)
abline(h=0,col="red")
plot(ts(df_smoothed_state$N[1:100], start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=y_lim_four)
# Plot DS (2.3)
### Figures 2.3 (ii),(iv) plot standard deviations instead of variances
### Missing first observation? Compare with book (pg 25/48)
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(df_disturbance$eps[2:99], start=c(1871, 1)), plot.type="single", ylab="", main="i", ylim=c(-300,300))
abline(h=0,col="red")
plot(ts(df_disturbance$sd_eps[2:99], start=c(1871, 1)), plot.type="single", ylab="", main="ii", ylim=c(45,65))
plot(ts(df_disturbance$eta[2:99], start=c(1871, 1)), plot.type="single", ylab="", main="iii", ylim=c(-40,40))
abline(h=0,col="red")
plot(ts(df_disturbance$sd_eta[2:99], start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(35,40))
# SKIP PLOT 2.4 - NOT NECESSARY
# Plot MV 2.5
par(mfrow=c(2,2),mar=c(4.1,4.1,1.1,2.1))
plot(ts(df_kalman_missing_data$a[2:99], start=c(1871, 1)), plot.type ="single", ylab="", main="i", ylim=c(500,1400))
plot(ts(df_kalman_missing_data$F[2:99], start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(min(df_kalman_missing_data$F[2:99]),max(df_kalman_missing_data$F[2:99])))
plot(ts(df_smoothed_state_missing_data$alpha[2:99], start=c(1871, 1)), plot.type ="single", ylab="", main="i", ylim=c(500,1400))
plot(ts(df_smoothed_state_missing_data$V[2:99], start=c(1871, 1)), plot.type="single", ylab="", main="iv", ylim=c(min(df_kalman_missing_data$F[2:99]),max(df_kalman_missing_data$F[2:99])))
# Plot Forecasting 2.6
# Plot Diagnostic Plots prediction errors 2.7
# Plot Diagnostic Plots auxilliary residuals 2.8
df_smoothed_state <- smoothed_state(df_kalman_filtered_state)
source(functions.R)
source(plotting.R)
