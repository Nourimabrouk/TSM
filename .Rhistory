col = "sienna",
cex = 0.5)
temp <- ts(c(out$etahat), start = 1871)
ylim <- range(out$etahat, eta.sim)
plot(
temp,
type = "l",
col = "blue",
ylim = c(-400, 300),
,
main = "iv"
)
points(1871:1970,
eta.sim,
pch = 19,
col = "sienna",
cex = 0.5)
Nile.miss <- Nile
Nile.miss[21:40] <- NA
Nile.miss[61:80] <- NA
model.miss <-
SSModel(Nile.miss ~ SSMtrend(1, Q = c(model$Q)) , H = c(model$H))
out.miss <- KFS(
model.miss,
filtering = 'state',
smoothing = c('state', 'signal', 'disturbance'),
simplify = F
)
par(mfrow = c(2, 2))
temp <- cbind(Nile.miss, c(out.miss$a)[-1])
cols <- c("grey", "blue")
plot.ts(
temp,
plot.type = "single",
col = cols,
xlab = "",
ylab = "",
main = "i",
lwd = c(1, 2, 2)
)
legend(
"topright",
legend = c("Observation Data", "Filtered"),
col = c("grey", "blue"),
lwd = c(1, 2),
bty = "n",
cex = 0.8
)
temp <- ts(c(out.miss$P)[-1], start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "ii"
)
temp <- cbind(Nile.miss, c(out.miss$alphahat))
cols <- c("grey", "blue")
plot.ts(
temp,
plot.type = "single",
col = cols,
xlab = "",
ylab = "",
main = "iii",
lwd = c(1, 2, 2)
)
legend(
"topright",
legend = c("Observation Data", "Smoothed"),
col = c("grey", "blue"),
lwd = c(1, 2),
bty = "n",
cex = 0.8
)
temp <- ts(c(out.miss$V)[-1], start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "iv"
)
data(Nile)
Nile
Nile2 <- c(Nile, rep(NA, 30))
model <-
SSModel(Nile2 ~ SSMtrend(1, Q = c(model$Q)) , H = c(model$H))
out <- KFS(
model,
filtering = 'state',
smoothing = c('state', 'signal', 'disturbance'),
simplify = F
)
par(mfrow = c(2, 2))
conf.bands <- cbind(out$a, as.vector(out$a) +
(sqrt(cbind(out$P)) * qnorm(0.95)) %*% (t(c(-1, 1))))
temp <- cbind(Nile2, conf.bands[-1,])
cols <- c("grey", "blue", "red", "red")
lwd <- c(1, 2, 1, 1)
lty <- c(1, 1, 2, 2)
plot.ts(
temp,
plot.type = "single",
col = cols,
lwd = lwd,
lty = lty,
xlab = "",
ylab = "",
main = "i"
)
legend(
"topright",
legend = c("Observation Data", "Forecasts", "Confidence intervals"),
col = c("grey", "blue", "red"),
lty = c(1, 1, 2),
lwd = c(1, 2, 1),
bty = "n",
cex = 0.8
)
temp <- ts(c(out$P)[-1], start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "ii"
)
temp <- ts(c(out$alphahat)[-1], start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
ylim = c(700, 1250),
main = "iii"
)
temp <- ts(c(out$F)[-1], start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "iv"
)
# 2.9 Param Est
model <-
SSModel(Nile ~ SSMtrend(1, Q = list(matrix(NA))) , H = matrix(NA))
model <- fitSSM(inits = c(log(var(Nile)) , log(var(Nile))) ,
model = model,
method = 'BFGS')$model
c(model$H)
c(model$Q)
out <-
KFS(
model,
filtering = 'state',
smoothing = c('state', 'signal', 'disturbance'),
simplify = F
)
stdres <- rstandard(out)
par(mfrow = c(2, 2))
temp <- ts(stdres, start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "i"
)
abline(h = 0, col = "grey")
par(mfrow = c(2, 2))
temp <- ts(stdres, start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "i"
)
abline(h = 0, col = "grey")
# 2.11 for fig 2.8
out <-
KFS(
model,
filtering = 'state',
smoothing = c('state', 'signal', 'disturbance'),
simplify = F
)
temp1 <- out$epshat / sqrt(c(out$V_eps))
temp2 <- out$etahat / sqrt(c(out$V_eta))
par(mfrow = c(2, 2))
temp <- ts(temp1, start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "i"
)
abline(h = 0, col = "grey")
hist(
temp,
prob = T,
col = "grey",
ylim = c(0, 0.3),
main = "ii",
xlab = "",
ylab = ""
)
lines(density(temp), col = "blue", lwd = 2)
par(mfrow = c(2, 2))
temp <- ts(temp1, start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "",
main = "i"
)
abline(h = 0, col = "grey")
hist(
temp,
prob = T,
col = "grey",
ylim = c(0, 0.3),
main = "ii",
xlab = "",
ylab = ""
)
lines(density(temp), col = "blue", lwd = 2)
temp <- ts(temp2, start = 1871)
plot(
temp,
col = "blue",
lwd = 2,
xlab = "",
ylab = "" ,
main = "iii"
)
abline(h = 0, col = "grey")
hist(
temp,
prob = T,
col = "grey",
main = "iv",
ylim = c(0, 1.2),
xlab = "",
ylab = ""
)
lines(density(temp), col = "blue", lwd = 2)
# 2.5 Missing data
missing_values_index <- c(21:40, 61:80)
data_missing <- data
data_missing[missing_values_index] <- NA
df_kalman_missing_data <- kalman_filter(data_missing, theta, sig_eps, sig_eta)
rm(list=ls())
# Imports ----------
library(tidyverse)
library(here)
source("functions.R")
options(warn=-1)
setwd(here())
data = Nile
# 2.1 Kalman Filter
sig_eps <- 15099
sig_eta <- 1469.1
a_ini <- 0
P_ini <- 10^7
theta <- c(a_ini, P_ini)
df_kalman_filtered_state <- kalman_filter(data, theta, sig_eps, sig_eta)
plotOne(df_kalman_filtered_state)
# 2.2  Smoothed State
df_smoothed_state <- smoothed_state(df_kalman_filtered_state)
plotTwo(df_smoothed_state)
# 2.3 Disturbance Smoothing
df_disturbance <- disturbances_smoothing(df_kalman_filtered_state, df_smoothed_state)
plotThree(df_disturbance)
# 2.5 Missing data
missing_values_index <- c(21:40, 61:80)
data_missing <- data
data_missing[missing_values_index] <- NA
df_kalman_missing_data <- kalman_filter(data_missing, theta, sig_eps, sig_eta)
df_smoothed_state_missing_data <- smoothed_state(df_kalman_missing_data)
df_disturbance_missing_data <- disturbances_smoothing(df_kalman_missing_data, df_smoothed_state_missing_data)
View(df_smoothed_state_missing_data)
View(df_smoothed_state)
View(df_kalman_missing_data)
View(df_kalman_filtered_state)
"
Time Series Models
Assignment 1
Authors:
Zeus Paraguas
Bart
Jari
Nouri Mabrouk 2623401
Main file to run the analysis
"
rm(list=ls())
# Imports ----------
library(tidyverse)
library(here)
source("functions.R")
options(warn=-1)
# Data import--------
setwd(here())
data = Nile
"2.1 Kalman Filter
Initialises values
Applies Kalman Filter
Plots results (figure 2.1)"
sig_eps <- 15099
sig_eta <- 1469.1
a_ini <- 0
P_ini <- 10^7
theta <- c(a_ini, P_ini)
df_kalman_filtered_state <- kalman_filter(data, theta, sig_eps, sig_eta)
plotOne(df_kalman_filtered_state)
"2.2  Smoothed State
Creates figure 2.2"
df_smoothed_state <- smoothed_state(df_kalman_filtered_state)
plotTwo(df_smoothed_state)
"2.3 Disturbance Smoothing
Creates figure 2.3"
df_disturbance <- disturbances_smoothing(df_kalman_filtered_state, df_smoothed_state)
plotThree(df_disturbance)
"2.5 Missing data
Creates missing data
Runs Kalman filter, state smoother, and disturbance smoother
Creates figure 2.5"
missing_values_index <- c(21:40, 61:80)
data_missing <- data
data_missing[missing_values_index] <- NA
df_kalman_missing_data <- kalman_filter(data_missing, theta, sig_eps, sig_eta)
df_smoothed_state_missing_data <- smoothed_state(df_kalman_missing_data)
df_disturbance_missing_data <- disturbances_smoothing(df_kalman_missing_data, df_smoothed_state_missing_data)
plotFive(df_kalman_missing_data, df_smoothed_state_missing_data)
"2.6"
"2.7"
"2.8"
"2.9"
'2.6'
"2.6"
"2.7"
"2.8"
"2.9"
"
Time Series Models
Assignment 1
Authors:
Zeus Paraguas
Bart
Jari
Nouri Mabrouk 2623401
Main file to run the analysis
"
rm(list=ls())
# Imports ----------
library(tidyverse)
library(here)
source("functions.R")
options(warn=-1)
# Data import--------
setwd(here())
data = Nile
"2.1 Kalman Filter
Initialises values
Applies Kalman Filter
Plots results (figure 2.1)"
sig_eps <- 15099
sig_eta <- 1469.1
a_ini <- 0
P_ini <- 10^7
theta <- c(a_ini, P_ini)
df_kalman_filtered_state <- kalman_filter(data, theta, sig_eps, sig_eta)
plotOne(df_kalman_filtered_state)
"2.2  Smoothed State
Creates figure 2.2"
df_smoothed_state <- smoothed_state(df_kalman_filtered_state)
plotTwo(df_smoothed_state)
"2.3 Disturbance Smoothing
Creates figure 2.3"
df_disturbance <- disturbances_smoothing(df_kalman_filtered_state, df_smoothed_state)
plotThree(df_disturbance)
"2.5 Missing data
Creates missing data
Runs Kalman filter, state smoother, and disturbance smoother
Creates figure 2.5"
missing_values_index <- c(21:40, 61:80)
data_missing <- data
data_missing[missing_values_index] <- NA
df_kalman_missing_data <- kalman_filter(data_missing, theta, sig_eps, sig_eta)
df_smoothed_state_missing_data <- smoothed_state(df_kalman_missing_data)
df_disturbance_missing_data <- disturbances_smoothing(df_kalman_missing_data, df_smoothed_state_missing_data)
plotFive(df_kalman_missing_data, df_smoothed_state_missing_data)
'2.6'
"2.6"
"2.7"
"2.8"
"2.9"
Time Series Models
Assignment 1
Authors:
Zeus Paraguas
Bart
Jari
Nouri Mabrouk 2623401
Main file to run the analysis
rm(list=ls())
# Imports ----------
library(tidyverse)
library(here)
source("functions.R")
options(warn=-1)
# Data import--------
setwd(here())
data = Nile
# 2.1 Kalman Filter
Initialises values
Applies Kalman Filter
Plots results (figure 2.1)
sig_eps <- 15099
sig_eta <- 1469.1
a_ini <- 0
P_ini <- 10^7
theta <- c(a_ini, P_ini)
df_kalman_filtered_state <- kalman_filter(data, theta, sig_eps, sig_eta)
plotOne(df_kalman_filtered_state)
# 2.2  Smoothed State
# Creates figure 2.2
df_smoothed_state <- smoothed_state(df_kalman_filtered_state)
plotTwo(df_smoothed_state)
# 2.3 Disturbance Smoothing
# Creates figure 2.3
df_disturbance <- disturbances_smoothing(df_kalman_filtered_state, df_smoothed_state)
plotThree(df_disturbance)
# 2.5 Missing data
# Creates missing data
# Runs Kalman filter, state smoother, and disturbance smoother
# Creates figure 2.5
missing_values_index <- c(21:40, 61:80)
data_missing <- data
data_missing[missing_values_index] <- NA
df_kalman_missing_data <- kalman_filter(data_missing, theta, sig_eps, sig_eta)
df_smoothed_state_missing_data <- smoothed_state(df_kalman_missing_data)
df_disturbance_missing_data <- disturbances_smoothing(df_kalman_missing_data, df_smoothed_state_missing_data)
plotFive(df_kalman_missing_data, df_smoothed_state_missing_data)
# 2.6
# 2.7
# 2.8
# 2.9
Time Series Models
Assignment 1
Authors:
Zeus Paraguas
Bart
Jari
Nouri Mabrouk 2623401
Main file to run the analysis
rm(list=ls())
# Imports ----------
library(tidyverse)
library(here)
source("functions.R")
options(warn=-1)
# Data import--------
setwd(here())
data = Nile
# 2.1 Kalman Filter
# Initialises values
# Applies Kalman Filter
# Plots results (figure 2.1)
sig_eps <- 15099
sig_eta <- 1469.1
a_ini <- 0
P_ini <- 10^7
theta <- c(a_ini, P_ini)
df_kalman_filtered_state <- kalman_filter(data, theta, sig_eps, sig_eta)
plotOne(df_kalman_filtered_state)
# 2.2  Smoothed State
# Creates figure 2.2
df_smoothed_state <- smoothed_state(df_kalman_filtered_state)
plotTwo(df_smoothed_state)
# 2.3 Disturbance Smoothing
# Creates figure 2.3
df_disturbance <- disturbances_smoothing(df_kalman_filtered_state, df_smoothed_state)
plotThree(df_disturbance)
# 2.5 Missing data
# Creates missing data
# Runs Kalman filter, state smoother, and disturbance smoother
# Creates figure 2.5
missing_values_index <- c(21:40, 61:80)
data_missing <- data
data_missing[missing_values_index] <- NA
df_kalman_missing_data <- kalman_filter(data_missing, theta, sig_eps, sig_eta)
df_smoothed_state_missing_data <- smoothed_state(df_kalman_missing_data)
df_disturbance_missing_data <- disturbances_smoothing(df_kalman_missing_data, df_smoothed_state_missing_data)
plotFive(df_kalman_missing_data, df_smoothed_state_missing_data)
# 2.6
# 2.7
# 2.8
# 2.9
