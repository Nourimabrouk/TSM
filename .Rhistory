Beta <- 0
c <- par_ini[3]
d <- mean_u
state_space_parameters <- data.frame(Z, H, T, R, Q, Beta, c, d)
ret_trans <- returns$transformed
res <- optimize_parameters(ret_trans, par_ini, state_space_parameters, printOutput = TRUE)
res2 <- optimize_parameters(stocks_data1, par_ini, state_space_parameters, printOutput = TRUE)
# e)
rm(list=ls())
source("functions.R")
rm(list=ls())
source("functions.R")
source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(fable)
setwd(here())
options(warn=-1)
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)
) %>%
as_tsibble()
y <- diff(log(stockdata$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
stocks_data1 <- cbind(x, rv)
sig_eps <- (pi^2)/2
mean_u <- -1.27
par_ini <- c(0.1082, 0.991, -0.207, 0.0)
Z <- 1
H <- sig_eps
T <- par_ini[2]
R <- par_ini[1]
Q <- 1
Beta <- 0
c <- par_ini[3]
d <- mean_u
state_space_parameters <- data.frame(Z, H, T, R, Q, Beta, c, d)
ret_trans <- returns$transformed
res <- optimize_parameters(ret_trans, par_ini, state_space_parameters, printOutput = TRUE)
res2 <- optimize_parameters(stocks_data1, par_ini, state_space_parameters, printOutput = TRUE)
rm(list=ls())
# Imports ----------
source("functions.R")
source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(fable)
setwd(here())
options(warn=-1)
# Data import & cleaning --------
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)
) %>%
as_tsibble()
# QML / cde? -----
y <- diff(log(stockdata$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
stocks_data1 <- cbind(x, rv)
sig_eps <- (pi^2)/2
mean_u <- -1.27
par_ini <- c(0.1082, 0.991, -0.207, 0.0)
Z <- 1
H <- sig_eps
T <- par_ini[2]
R <- par_ini[1]
Q <- 1
Beta <- 0
c <- par_ini[3]
d <- mean_u
state_space_parameters <- data.frame(Z, H, T, R, Q, Beta, c, d)
ret_trans <- returns$transformed
res <- optimize_parameters(ret_trans, par_ini, state_space_parameters, TRUE)
res2 <- optimize_parameters(stocks_data1, par_ini, state_space_parameters, TRUE)
# e)
res2 <- optimize_parameters(stocks_data1, par_ini, state_space_parameters, FALSE)
res2 <- optimize_parameters(stocks_data1, par_ini, state_space_parameters, TRUE)
res <- optimize_parameters(ret_trans, par_ini, state_space_parameters, FALSE)
rm(list=ls())
source("functions.R")
source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(fable)
setwd(here())
options(warn=-1)
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)
) %>%
as_tsibble()
# QML / cde? -----
y
rv <- stockdata$RV[-1]
rv
stockdata
stockdata %>% mutate(
y = diff(log(stockdata$Close)),
x = log((y - mean(y))^2)
)
transformed_stocks <- stockdata %>%
transmute(
y = diff(log(stockdata$Close)),
x = log((y - mean(y))^2)
)
transformed_stocks <- stockdata %>%
y = diff(log(stockdata$Close)),
x = log((y - mean(y))^2)
transformed_stocks <- stockdata %>%
y = diff(log(stockdata$Close)),
x = log((y - mean(y))^2)
# QML / cde? -----
stockdata
# QML / cde? -----
stockdata %>%
mutate(
y = diff(log(stockdata$Close))
)
y <- diff(log(stockdata$Close)) %>% as_tibble()
y
transformed_stockdata <-
diff(log(stockdata$Close)) %>% as_tibble()
transformed_stockdata
transformed_stockdata <-
y ->diff(log(stockdata$Close)) %>% as_tibble()
transformed_stockdata <-
diff(log(stockdata$Close)) %>% as_tibble()
transformed_stockdata
transmute(x = log((value - mean(value))^2))
transformed_stockdata <-
diff(log(stockdata$Close)) %>% as_tibble() %>%
transmute(x = log((value - mean(value))^2))
transformed_stockdata <-
diff(log(stockdata$Close)) %>% as_tibble() %>%
transmute(x = log((value - mean(value))^2),
rv = RV[-1])
transformed_stockdata <-
diff(log(stockdata$Close)) %>% as_tibble() %>%
transmute(x = log((value - mean(value))^2),
rv = stockdata$RV[-1])
transformed_stockdata
stocks_data1 <- cbind(x, rv)
res2 <- optimize_parameters(transformed_stockdata, par_ini, state_space_parameters, TRUE)
y <- diff(log(stockdata$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
stocks_data1 <- cbind(x, rv)
rm(list=ls())
source("functions.R")
source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(fable)
setwd(here())
options(warn=-1)
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)) %>%
as_tsibble()
y <- diff(log(stockdata$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
stocks_data1 <- cbind(x, rv)
sig_eps <- (pi^2)/2
mean_u <- -1.27
par_ini <- c(0.1082, 0.991, -0.207, 0.0)
stocks_data1
class(stocks_data1  )
# QML / cde? -----
perform_QML_routine <- function(stockdata){
y <- diff(log(data$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
stocks_data1 <- cbind(x, rv)
}
state_space_parameters <- data.frame(Z = 1
, H, T, R, Q, Beta, c, d)
Q <- 1
Z <- 1
H <- sig_eps
R <- par_ini[1]
T <- par_ini[2]
c <- par_ini[3]
d <- mean_u
state_space_parameters <- data.frame(Z = 1
, H, T, R, Q, Beta, c, d)
Beta <- 0
state_space_parameters <- data.frame(
Q = 1,
Z = 1,
H = sig_eps,
R = par_ini[1],
T = par_ini[2],
c = par_ini[3],
d = mean_u,
Beta = 0
)
input_matrix_stocks <- cbind(x, rv)
res2 <- optimize_parameters(input_matrix_stocks, par_ini, state_space_parameters, TRUE)
res <- optimize_parameters(input_returns, par_ini, state_space_parameters, TRUE) # (Print_output = TRUE)
res2 <- optimize_parameters(input_matrix_stocks, par_ini, state_space_parameters, TRUE)
perform_QML_routine(returns, stockdata)
# QML / cde? -----
perform_QML_routine = function(returns, stockdata){
# Create transformed data matrix
y = diff(log(stockdata$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
input_matrix_stocks <- cbind(x, rv)
input_returns <- returns$transformed
# Initialise parameters
sig_eps <- (pi^2)/2 # Given in assignment
mean_u <- -1.27 # Given in assignment
par_ini <- c(0.1082, 0.991, -0.207, 0.0)
Beta <- 0
state_space_parameters <- data.frame(
Q = 1,
Z = 1,
H = sig_eps,
R = par_ini[1],
T = par_ini[2],
c = par_ini[3],
d = mean_u,
Beta = 0
)
res <- optimize_parameters(input_returns, par_ini, state_space_parameters, TRUE) # (Print_output = TRUE)
res2 <- optimize_parameters(input_matrix_stocks, par_ini, state_space_parameters, TRUE)
}
perform_QML_routine(returns, stockdata)
# QML / cde? -----
perform_QML_routine = function(returns, stockdata){
# Create transformed data matrix
y = diff(log(stockdata$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
input_matrix_stocks <- cbind(x, rv)
input_returns <- returns$transformed
# Initialise parameters
sig_eps <- (pi^2)/2 # Given in assignment
mean_u <- -1.27 # Given in assignment
par_ini <- c(0.1082, 0.991, -0.207, 0.0)
Beta <- 0
state_space_parameters <- data.frame(
Q = 1,
Z = 1,
H = sig_eps,
R = par_ini[1],
T = par_ini[2],
c = par_ini[3],
d = mean_u,
Beta = 0
)
res <- optimize_parameters(input_returns, par_ini, state_space_parameters, TRUE) # (Print_output = TRUE)
res2 <- optimize_parameters(input_matrix_stocks, par_ini, state_space_parameters, TRUE)
}
perform_QML_routine(returns, stockdata)
for (t in 1:n) {
values = draw_values()
weights = compute_weights()
normalised_weights = normalise_weights()
c(att, ptt) = compute_att_ptt()
a_t_i = resampling()
}
return(theta_0)
draw_values <- function(){
var = sigma_eta^2 / (1 - phi^2)
theta_0 = rnorm(n, 0, var)
return(theta_0)
}
# resample with replacements and weights
sample = vec(100)
# resample with replacements and weights
sample = vector(100)
# resample with replacements and weights
sample = tibble(x=1:100)
# resample with replacements and weights
resample_input = tibble(
sample = 1:100,
weights = rnorm(100,1,.5))
resample_input
resample_input[sample]
resampled = resample_input %>% sample_n(sample, 100, replace = FALSE, weight = NULL, .env = NULL, ...)
resampled = resample_input %>% sample_n(sample, 100, replace = FALSE, weight = NULL)
resampled
resampled = resample_input %>% sample_n(sample, 100, replace = TRUE, weight = weights)
# resample with replacements and weights
resample_input = tibble(
sample = 1:100,
weights = abs(rnorm(100,1,.5)))
resampled = resample_input %>% sample_n(sample, 100, replace = TRUE, weight = weights)
resampled
resampled = resample_input %>% sample_n(sample, 10, replace = TRUE, weight = weights)
resampled
resampled = sample_n(input$sample, 10, replace = TRUE, weight = input$weights)
resampled
# resample with replacements and weights
input = tibble(
sample = 1:100,
weights = abs(rnorm(100,1,.5)))
resampled = sample_n(input$sample, 10, replace = TRUE, weight = input$weights)
resampled
# resample with replacements and weights
input = data.frame(
sample = 1:100)
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 10, replace = TRUE, weight = input$weights)
resampled
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
resampled
a_hat_t_t = 1:100
p_hat_t_t = 1:100
c(a_hat_t_t, p_hat_t_t)
cbind(a_hat_t_t, p_hat_t_t)
return(cbind(a_hat_t_t, p_hat_t_t))
a_hat_t_t = 1:100
p_hat_t_t = 1:100
cbind(a_hat_t_t, p_hat_t_t)
df <- cbind(a_hat_t_t, p_hat_t_t)
df
df_att_ptt <- cbind(a_hat_t_t, p_hat_t_t)
resampling<- function(df_att_ptt){
# Resampling from pg 281 or 284
att = data.frame()
# Trial code
# resample with replacements and weights
input = data.frame(
att = )
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
}
# Resampling from pg 281 or 284
att = df_att_ptt[,1]
att
weights = df_att_ptt_weights[,3]
df_att_ptt_weights <- cbind(a_hat_t_t, p_hat_t_t)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
}
# stratified sampling 12.3.3 ?
return(resampeled)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampeled)
}
resampling(df_att_ptt_weights)
a_hat_t_t = 1:100
p_hat_t_t = 1:100
weights = 1:100
weights = 100:1
df_att_ptt_weights <- cbind(a_hat_t_t, p_hat_t_t, weights)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampeled)
}
resampling(df_att_ptt_weights)
# stratified sampling 12.3.3 ?
return(resampled)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampled)
}
resampling(df_att_ptt_weights)
weights = 100:1 / sum(100:1)
df_att_ptt_weights <- cbind(a_hat_t_t, p_hat_t_t, weights)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampled)
}
weights
resampling(df_att_ptt_weights)
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
return(resampled)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
return(resampled)
}
resampling(df_att_ptt_weights)
perform_QML_routine(returns, stockdata)
rm(list=ls())
source("functions.R")
source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(fable)
setwd(here())
options(warn=-1)
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)) %>%
as_tsibble()
perform_QML_routine(returns, stockdata)
