Z = 1,
H = sig_eps,
R = par_ini[1],
T = par_ini[2],
c = par_ini[3],
d = mean_u,
Beta = 0
)
res <- optimize_parameters(input_returns, par_ini, state_space_parameters, TRUE) # (Print_output = TRUE)
res2 <- optimize_parameters(input_matrix_stocks, par_ini, state_space_parameters, TRUE)
}
perform_QML_routine(returns, stockdata)
# QML / cde? -----
perform_QML_routine = function(returns, stockdata){
# Create transformed data matrix
y = diff(log(stockdata$Close))
x <- log((y - mean(y))^2)
rv <- stockdata$RV[-1]
input_matrix_stocks <- cbind(x, rv)
input_returns <- returns$transformed
# Initialise parameters
sig_eps <- (pi^2)/2 # Given in assignment
mean_u <- -1.27 # Given in assignment
par_ini <- c(0.1082, 0.991, -0.207, 0.0)
Beta <- 0
state_space_parameters <- data.frame(
Q = 1,
Z = 1,
H = sig_eps,
R = par_ini[1],
T = par_ini[2],
c = par_ini[3],
d = mean_u,
Beta = 0
)
res <- optimize_parameters(input_returns, par_ini, state_space_parameters, TRUE) # (Print_output = TRUE)
res2 <- optimize_parameters(input_matrix_stocks, par_ini, state_space_parameters, TRUE)
}
perform_QML_routine(returns, stockdata)
for (t in 1:n) {
values = draw_values()
weights = compute_weights()
normalised_weights = normalise_weights()
c(att, ptt) = compute_att_ptt()
a_t_i = resampling()
}
return(theta_0)
draw_values <- function(){
var = sigma_eta^2 / (1 - phi^2)
theta_0 = rnorm(n, 0, var)
return(theta_0)
}
# resample with replacements and weights
sample = vec(100)
# resample with replacements and weights
sample = vector(100)
# resample with replacements and weights
sample = tibble(x=1:100)
# resample with replacements and weights
resample_input = tibble(
sample = 1:100,
weights = rnorm(100,1,.5))
resample_input
resample_input[sample]
resampled = resample_input %>% sample_n(sample, 100, replace = FALSE, weight = NULL, .env = NULL, ...)
resampled = resample_input %>% sample_n(sample, 100, replace = FALSE, weight = NULL)
resampled
resampled = resample_input %>% sample_n(sample, 100, replace = TRUE, weight = weights)
# resample with replacements and weights
resample_input = tibble(
sample = 1:100,
weights = abs(rnorm(100,1,.5)))
resampled = resample_input %>% sample_n(sample, 100, replace = TRUE, weight = weights)
resampled
resampled = resample_input %>% sample_n(sample, 10, replace = TRUE, weight = weights)
resampled
resampled = sample_n(input$sample, 10, replace = TRUE, weight = input$weights)
resampled
# resample with replacements and weights
input = tibble(
sample = 1:100,
weights = abs(rnorm(100,1,.5)))
resampled = sample_n(input$sample, 10, replace = TRUE, weight = input$weights)
resampled
# resample with replacements and weights
input = data.frame(
sample = 1:100)
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 10, replace = TRUE, weight = input$weights)
resampled
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
resampled
a_hat_t_t = 1:100
p_hat_t_t = 1:100
c(a_hat_t_t, p_hat_t_t)
cbind(a_hat_t_t, p_hat_t_t)
return(cbind(a_hat_t_t, p_hat_t_t))
a_hat_t_t = 1:100
p_hat_t_t = 1:100
cbind(a_hat_t_t, p_hat_t_t)
df <- cbind(a_hat_t_t, p_hat_t_t)
df
df_att_ptt <- cbind(a_hat_t_t, p_hat_t_t)
resampling<- function(df_att_ptt){
# Resampling from pg 281 or 284
att = data.frame()
# Trial code
# resample with replacements and weights
input = data.frame(
att = )
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
}
# Resampling from pg 281 or 284
att = df_att_ptt[,1]
att
weights = df_att_ptt_weights[,3]
df_att_ptt_weights <- cbind(a_hat_t_t, p_hat_t_t)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
}
# stratified sampling 12.3.3 ?
return(resampeled)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampeled)
}
resampling(df_att_ptt_weights)
a_hat_t_t = 1:100
p_hat_t_t = 1:100
weights = 1:100
weights = 100:1
df_att_ptt_weights <- cbind(a_hat_t_t, p_hat_t_t, weights)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampeled)
}
resampling(df_att_ptt_weights)
# stratified sampling 12.3.3 ?
return(resampled)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampled)
}
resampling(df_att_ptt_weights)
weights = 100:1 / sum(100:1)
df_att_ptt_weights <- cbind(a_hat_t_t, p_hat_t_t, weights)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 281 or 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
# Trial code
# resample with replacements and weights
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
# stratified sampling 12.3.3 ?
return(resampled)
}
weights
resampling(df_att_ptt_weights)
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
return(resampled)
resampling<- function(df_att_ptt_weights){
# Resampling from pg 284
att = df_att_ptt_weights[,1]
weights = df_att_ptt_weights[,3]
weights = abs(rnorm(100,1,.5))
resampled = sample_n(input, 100, replace = TRUE, weight = input$weights)
return(resampled)
}
resampling(df_att_ptt_weights)
perform_QML_routine(returns, stockdata)
rm(list=ls())
source("functions.R")
source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(fable)
setwd(here())
options(warn=-1)
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)) %>%
as_tsibble()
perform_QML_routine(returns, stockdata)
source("functions.R")
#source("Plotting.R")
library(here)
library(tidyverse)
library(tsibble)
library(lubridate)
library(scales)
library(ggplot2)
library(fable)
setwd(here())
options(warn=-1)
# Data import & cleaning --------
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x))/100,
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)) %>%
as_tsibble()
# ab
transformed_df = transform_data(stockdata, returns)
input_stocks = transformed_df[[1]]
input_returns = transformed_df[[2]]
#c / e -> need to separate these?
initial_parameters = initialise_parameters_QML()
state_space_parameters = initial_parameters[[1]]
par_ini = initial_parameters[[2]]
QML_params_returns <- optimize_parameters(input_returns, par_ini, state_space_parameters, TRUE) # (Print_output = TRUE)
QML_params_stocks <- optimize_parameters(input_stocks, par_ini, state_space_parameters, TRUE)
#d
outputKalman_returns <- compute_kalmanfilter(input_returns, QML_params_returns, state_space_parameters)
outputSmooth_returns <- compute_smoothed_state(input_returns, QML_params_returns, outputKalman_returns)
outputKalman_stocks <- compute_kalmanfilter(input_stocks[,1], QML_params_stocks, state_space_parameters)
outputSmooth_stocks <- compute_smoothed_state(input_stocks[,1],QML_params_stocks, outputKalman_stocks)
outputSmooth_returns
initial_parameters = initialise_parameters_QML()
state_space_parameters = initial_parameters[[1]]
par_ini = initial_parameters[[2]]
QML_params_returns <- optimize_parameters(input_returns, par_ini, state_space_parameters, TRUE) # (Print_output = TRUE)
QML_params_stocks <- optimize_parameters(input_stocks, par_ini, state_space_parameters, TRUE)
plot(outputSmooth_returns)
plot(outputSmooth_returns$alpha)
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-1,4))
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
transformed_df[[2]]
points(transformed_df[[2]], col="red")
points(transformed_df[[2]], col="red")
points(transformed_df[[2]], col="red")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(transformed_df[[2]], col="red")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(transformed_df[[2]], col="black")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(returns$transformed, col="black")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(returns$transformed, col="black")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(returns$transformed, col="black")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(returns$transformed, col="black")
plot(ts(returns$transformed) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(ts(returns$transformed) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(ts(returns$transformed) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(returns$transformed, col="black")
plot(returns$transformed , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(returns$transformed , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(returns$transformed , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(returns$transformed , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-40,40))
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
points(returns$transformed, col="black")
library(tseries)
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
points(returns$transformed, col="black")
plot(returns$transformed , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-40,40))
plot(ts(returns$transformed) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-40,40))
plot(ts(returns$transformed/100) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-40,40))
plot(ts(returns$transformed/100) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
points(returns$transformed, col="black")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
plot(ts(returns$transformed/100) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(returns$transformed, col="black")
plot(ts(returns$transformed/100) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-4,1))
points(returns$transformed/100, col="black")
plot(ts(outputSmooth_returns$alpha) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
lines(returns$transformed, col="black")
plot(ts(outputSmooth_returns$alpha*100) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
lines(returns$transformed, col="black")
plot(ts(outputSmooth_returns$alpha*10) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
lines(returns$transformed, col="black")
plot(ts(outputSmooth_returns$alpha*10) , col="red", plot.type="single", ylab="", main="h_t", ylim=c(-30,1))
points(returns$transformed, col="black")
install.packages(c("tseries", "moments"))
library(tseries)
library(moments)
descriptive_stats <- function(data){
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- data.frame(mean,var,min,max,skew,kurt)
return(descriptive)
}
data
descriptive_stats <- function(data){
number_observations <- nrow(data)
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- data.frame(mean,var,min,max,skew,kurt)
return(descriptive)
}
descriptive_stats <- function(data){
number_observations <- nrow(data)
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- data.frame(data,mean,var,min,max,skew,kurt)
return(descriptive)
}
returns
descriptive_a <- descriptive_stats(returns$x)
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_e <- descriptive_stats(transformed_df[1])
descriptive_stats <- function(data){
number_observations <- nrow(data)
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- data.frame(data,mean,var,min,max,skew,kurt)
return(descriptive)
}
descriptive_stats <- function(data){
number_observations <- nrow(data)
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- data.frame(data,mean,var,min,max,skew,kurt)
return(descriptive)
}
source("functions.R")
data <- read.delim(here('Data', 'sv.dat'))
stocks <- read_csv(here('Data', 'oxfordmanrealizedvolatilityindices.csv'))
returns <- data %>%
mutate(index = 1:nrow(data)) %>%
relocate(index) %>%
as_tsibble(index = index) %>%
rename(x = X...Pound.Dollar.daily.exchange.rates..sections.9.6.and.14.4) %>%
mutate(demeaned = (x - mean(x)),
transformed = log(demeaned^2))
stockdata <- stocks %>%
filter(Symbol == ".SPX" & year(X1) > 2015) %>%
select(X1,close_price, rk_parzen) %>% # replace rk_parzen with realized volatility measure of choice
rename(Date = X1, Close = close_price, RV = rk_parzen) %>%
mutate(RV = log(RV)) %>%
as_tsibble()
# ab
transformed_df = transform_data(stockdata, returns)
input_stocks = transformed_df[[1]]
input_returns = transformed_df[[2]]
# Descriptive stats
descriptive_a <- descriptive_stats(returns$x)
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_e <- descriptive_stats(transformed_df[1])
transformed_df[1]
descriptive_a <- descriptive_stats(returns$x)
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_e <- descriptive_stats(stockdata$RV)
descriptive_a <- descriptive_stats(returns$x)
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_e <- descriptive_stats(stockdata$RV)
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_b
descriptive_e <- descriptive_stats(stockdata$RV)
descriptive_e
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_b
descriptive_e <- descriptive_stats(stockdata$RV)
descriptive_e
mean(returns$x)
descriptive_stats <- function(data){
number_observations <- nrow(data)
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- data.frame(number_observations,mean,var,min,max,skew,kurt)
return(descriptive)
}
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
source("functions.R")
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_b
descriptive_e <- descriptive_stats(stockdata$RV)
descriptive_e
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_b
descriptive_e <- descriptive_stats(stockdata$RV)
descriptive_e
descriptive_stats <- function(data){
number_observations <- nrow(data)
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- c(number_observations,mean,var,min,max,skew,kurt)
return(descriptive)
}
source("functions.R")
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_b
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
source("functions.R")
#source("Plotting.R")
source("functions.R")
#source("Plotting.R")
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
source("functions.R")
# Descriptive stats
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_stats <- function(data){
number_observations <- length(data)
mean <- mean(data)
var <- var(data)
min <- min(data)
max <- max(data)
skew <- skewness(data)
kurt <- kurtosis(data)
descriptive <- data.frame(number_observations,mean,var,min,max,skew,kurt)
return(descriptive)
}
descriptive_a <- descriptive_stats(returns$x)
descriptive_a
descriptive_b <- descriptive_stats(returns$transformed)
descriptive_b
descriptive_e <- descriptive_stats(stockdata$RV)
descriptive_e
